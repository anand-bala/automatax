#!/usr/bin/env bash

set -euo pipefail

export PIXI_BETA_WARNING_OFF=true

if ! nvidia_smi="$(type -p "nvidia-smi")" || [[ -z "$nvidia_smi" ]]; then
  pixi_env="dev"
else
  # HACK: may be a bit fragile
  # Return the __cuda virtual system requirement version from pixi
  cuda_major_version=$(pixi info | awk 'BEGIN { FS = "[: \t\n=.]+"}; /__cuda/ { print $3}; ')
  pixi_env="cuda${cuda_major_version}-dev"
fi

echo "pixi env = $pixi_env"

eval "$(pixi shell-hook -e "$pixi_env")"
